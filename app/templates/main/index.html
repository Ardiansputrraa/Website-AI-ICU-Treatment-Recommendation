<html>
  <head>
    {% include 'component/header.html'%}
  </head>
  <body class="dark:bg-gray-950 bg-gray-200">
    {% include 'component/navbar.html'%}

    <main class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4 p-4">
      <!-- Patient Details -->
      <section
        class="col-span-1 md:col-span-2 lg:col-span-1 dark:bg-gray-900 bg-white p-4 rounded-lg"
      >
        <h2 class="text-lg font-bold dark:text-white mb-4">Patient Details</h2>
        <div class="flex items-center pt-2">
          <i
            class="mdi mdi-account text-2xl transition duration-75 text-cyan-500 mr-2"
          ></i>
          <p class="dark:text-gray-300 text-gray-800">Adam Gilchrist</p>
        </div>
        <div class="flex items-center pt-3">
          <i
            class="mdi mdi-home text-2xl transition duration-75 text-cyan-500 mr-2"
          ></i>
          <p class="dark:text-gray-300 text-gray-800">
            123 Kings Road Brisbane
          </p>
        </div>
        <div class="flex items-center pt-3">
          <i
            class="mdi mdi-clock-time-eight text-2xl text-cyan-500 transition duration-75 mr-2"
          ></i>
          <p class="dark:text-gray-300 text-gray-800">Tue 3 Mar 2022</p>
        </div>
        <img
          src="{{url_for('static', filename='src/images/assets/x-ray.png')}}"
          alt="Patient Body"
          class="mx-auto my-4 pt-6 h-80 mb-5 w-70"
        />

        <div class="flex space-x-4 pt-10">
          <button
            class="w-auto text-sm py-2 px-2 rounded-lg text-white bg-cyan-500 hover:bg-cyan-700 transition dark:hover:bg-cyan-700 duration-200"
          >
            CHEST X-RAY
          </button>
          <button
            class="w-auto text-sm py-2 px-2 rounded-lg text-white bg-cyan-500 hover:bg-cyan-700 transition dark:hover:bg-cyan-700 duration-200"
          >
            MRI
          </button>
        </div>
      </section>

      <!-- Vitals -->
      <section
        class="col-span-1 md:col-span-2 lg:col-span-1 dark:bg-gray-900 bg-white p-4 rounded-lg"
      >
        <!-- Heart Rate -->
        <div class="mb-6">
          <!-- Ikon dan Judul -->
          <div class="flex items-center justify-between mb-4">
            <!-- Tambahkan ikon MDI -->
            <div class="flex flex-col items-start">
              <i class="mdi mdi-heart-pulse text-6xl text-red-500"></i>
              <p class="text-sm mt-2 text-gray-900 dark:text-gray-200">
                HEART RATE
              </p>
            </div>

            <!-- Value -->
            <div class="flex items-baseline">
              <p
                class="text-4xl font-bold text-black dark:text-white"
                id="heart-rate-value"
              >
                60
              </p>
              <p class="text-sm text-black dark:text-white ml-1">bpm</p>
            </div>
          </div>
          <!-- Grafik -->
          <div>
            <canvas id="heartRate" class="w-full h-40"></canvas>
          </div>
        </div>

        <!-- Oxygen Saturation -->
        <div class="mb-6">
          <!-- Ikon dan Judul -->
          <div class="flex items-center justify-between mb-4">
            <!-- Tambahkan ikon MDI -->
            <div class="flex flex-col items-start">
              <i class="mdi mdi-heart-plus-outline text-6xl text-red-500"></i>
              <p class="text-sm mt-2 text-gray-900 dark:text-gray-200">
                OXYGEN SATURATION
              </p>
            </div>

            <!-- Value -->
            <div class="flex items-baseline">
              <p
                class="text-4xl font-bold text-black dark:text-white"
                id="heart-rate-value"
              >
                60
              </p>
              <p class="text-sm text-black dark:text-white ml-1">%</p>
            </div>
          </div>
          <!-- Grafik -->
          <div>
            <canvas id="oxygenSaturation" class="w-full h-40"></canvas>
          </div>
        </div>

        <!-- Respiratory Rate -->
        <div class="mb-6">
          <!-- Ikon dan Judul -->
          <div class="flex items-center justify-between mb-4">
            <!-- Tambahkan ikon MDI -->
            <div class="flex flex-col items-start">
              <i class="mdi mdi-lungs text-6xl text-red-500"></i>
              <p class="text-sm mt-2 text-gray-900 dark:text-gray-200">
                RESPIRATORY RATE
              </p>
            </div>
            <!-- Value -->
            <div class="flex items-baseline">
              <p
                class="text-4xl font-bold text-black dark:text-white"
                id="heart-rate-value"
              >
                60
              </p>
              <p class="text-sm text-black dark:text-white ml-1">rpm</p>
            </div>
          </div>
          <!-- Grafik -->
          <div>
            <canvas id="respiratoryRate" class="w-full h-40"></canvas>
          </div>
        </div>
      </section>

      <script>
        // Waktu untuk pembaruan data
        let time = 0;

        function generateHeartRateWaveform(t) {
          const baseline = 75; // Rata-rata heart rate normal (bpm)
          const amplitude = 5; // Fluktuasi kecil di sekitar baseline (5 bpm)
          const frequency = 0.1; // Frekuensi gelombang lambat (1 siklus dalam 10 detik)
          const smoothFactor = 0.02; // Faktor pergerakan yang halus untuk perubahan grafik
          const noise = Math.random() * 0.5 - 0.25; // Variasi kecil (noise) untuk membuat grafik alami
        
          // Membuat gelombang sinusoidal dengan pergerakan yang halus
          const heartRate = baseline + amplitude * Math.sin(frequency * t) + noise;
        
          // Menjaga pergerakan naik turun dengan transisi yang stabil
          const smoothHeartRate = heartRate * (1 - smoothFactor) + baseline * smoothFactor;
        
          // Memastikan nilai berada di rentang yang wajar (50-120 bpm)
          return Math.min(Math.max(smoothHeartRate, 50), 120);
        }
        

        // Fungsi untuk menghasilkan data Oxygen Saturation waveform
        function generateOxygenSaturationWaveform(t) {
          // Sesuaikan amplitudo, baseline, dan frekuensi
          const amplitude = 2;
          const baseline = 98;
          const frequency = 0.2;
          const noise = Math.random() * 0.5 - 0.25;

          // Hubungkan fase dengan heart rate untuk sinkronisasi
          return (
            baseline + amplitude * Math.sin(frequency * t + Math.PI / 2) + noise
          );
        }

        // Fungsi untuk menghasilkan data Respiratory Rate waveform
        function generateRespiratoryRateWaveform(t) {
          const amplitude = 2; // Sesuaikan amplitudo
          const baseline = 20; // Sesuaikan baseline
          const frequency = 0.1; // Sesuaikan frekuensi
          const noise = Math.random() * 1 - 0.5; // Noise acak

          return baseline + amplitude * Math.sin(frequency * t) + noise;
        }

        // Fungsi untuk inisialisasi grafik
        function insialisasiChart() {
          // Inisialisasi Chart.js untuk grafik Heart Rate
          const heartRateCtx = document
            .getElementById("heartRate")
            .getContext("2d");
          const heartRateChart = new Chart(heartRateCtx, {
            type: "line",
            data: {
              labels: Array.from({ length: 100 }, () => ""), // Label kosong
              datasets: [
                {
                  borderColor: "#9933FF", // Warna garis ungu
                  borderWidth: 2,
                  fill: false,
                  tension: 0.4, // Membuat garis lebih mulus
                  data: Array.from({ length: 100 }, (_, i) =>
                    generateHeartRateWaveform(i)
                  ), // Data awal
                },
              ],
            },
            options: {
              responsive: true,
              animation: false,
              plugins: {
                legend: { display: false }, // Sembunyikan legenda
              },
              scales: {
                x: { display: false }, // Sembunyikan sumbu X
                y: { display: false }, // Sembunyikan sumbu Y
              },
              elements: {
                point: { radius: 0 }, // Hilangkan titik
              },
            },
          });

          // Inisialisasi Chart.js untuk grafik Oxygen Saturation
          const oxygenSaturationCtx = document
            .getElementById("oxygenSaturation")
            .getContext("2d");
          const oxygenSaturationChart = new Chart(oxygenSaturationCtx, {
            type: "line",
            data: {
              labels: Array.from({ length: 100 }, () => ""), // Label kosong
              datasets: [
                {
                  borderColor: "#9933FF", // Warna garis hijau
                  borderWidth: 2,
                  fill: false,
                  tension: 0.4, // Membuat garis lebih mulus
                  data: Array.from({ length: 100 }, (_, i) =>
                    generateOxygenSaturationWaveform(i)
                  ), // Data awal
                },
              ],
            },
            options: {
              responsive: true,
              animation: false,
              plugins: {
                legend: { display: false }, // Sembunyikan legenda
              },
              scales: {
                x: { display: false }, // Sembunyikan sumbu X
                y: { display: false }, // Rentang nilai Oxygen Saturation
              },
              elements: {
                point: { radius: 0 }, // Hilangkan titik
              },
            },
          });

          // Inisialisasi Chart.js untuk grafik Respiratory Rate
          const respiratoryRateCtx = document
            .getElementById("respiratoryRate")
            .getContext("2d");
          const respiratoryRateChart = new Chart(respiratoryRateCtx, {
            type: "line",
            data: {
              labels: Array.from({ length: 100 }, () => ""), // Label kosong
              datasets: [
                {
                  borderColor: "#9933FF", // Warna garis merah (untuk Respiratory Rate)
                  borderWidth: 2,
                  fill: false,
                  tension: 0.4, // Membuat garis lebih mulus
                  data: Array.from({ length: 100 }, (_, i) =>
                    generateRespiratoryRateWaveform(i)
                  ), // Data awal
                },
              ],
            },
            options: {
              responsive: true,
              animation: false,
              plugins: {
                legend: { display: false }, // Sembunyikan legenda
              },
              scales: {
                x: { display: false }, // Sembunyikan sumbu X
                y: { display: false }, // Rentang nilai Respiratory Rate (12 - 20)
              },
              elements: {
                point: { radius: 0 }, // Hilangkan titik
              },
            },
          });

          return {
            heartRateChart,
            oxygenSaturationChart,
            respiratoryRateChart,
          };
        }

        // Inisialisasi grafik dan perbarui data setiap 100ms
        window.onload = () => {
          const {
            heartRateChart,
            oxygenSaturationChart,
            respiratoryRateChart,
          } = insialisasiChart();

          // Update data setiap 100ms
          setInterval(() => {
            const heartRate = generateHeartRateWaveform(time++);
            heartRateChart.data.datasets[0].data.shift(); // Hapus data pertama
            heartRateChart.data.datasets[0].data.push(heartRate); // Tambahkan data baru
            heartRateChart.update(); // Perbarui grafik

            const oxygenSaturation = generateOxygenSaturationWaveform(time++);
            oxygenSaturationChart.data.datasets[0].data.shift(); // Hapus data pertama
            oxygenSaturationChart.data.datasets[0].data.push(oxygenSaturation); // Tambahkan data baru
            oxygenSaturationChart.update(); // Perbarui grafik

            const respiratoryRate = generateRespiratoryRateWaveform(time++);
            respiratoryRateChart.data.datasets[0].data.shift(); // Hapus data pertama
            respiratoryRateChart.data.datasets[0].data.push(respiratoryRate); // Tambahkan data baru
            respiratoryRateChart.update(); // Perbarui grafik
          }, 300); // Update data setiap 100ms
        };
      </script>

      <!-- Recommended Treatments -->
      <section
        class="col-span-1 md:col-span-6 lg:col-span-4 bg-gray-800 p-4 rounded-lg"
      >
        <h2 class="text-lg font-bold">Recommended Treatments</h2>
        <table class="table-auto w-full text-left mt-4">
          <thead>
            <tr class="bg-gray-700">
              <th class="p-2">Drug Name</th>
              <th class="p-2">Strength</th>
              <th class="p-2">Dose</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td class="p-2">Tacrolimus</td>
              <td class="p-2">1mg Capsule</td>
              <td class="p-2">2mg</td>
            </tr>
            <tr>
              <td class="p-2">Warfarin</td>
              <td class="p-2">5mg Tablet</td>
              <td class="p-2">5mg</td>
            </tr>
            <tr>
              <td class="p-2">Heparin Sodium</td>
              <td class="p-2">25000 unit Premix Bag</td>
              <td class="p-2">25000 unit</td>
            </tr>
          </tbody>
        </table>
        <div class="mt-4">
          <label for="custom-treatment" class="block mb-2"
            >Customise Treatment:</label
          >
          <input
            id="custom-treatment"
            type="text"
            placeholder="Diagnosis details"
            class="input input-bordered w-full"
          />
          <button class="btn btn-primary w-full mt-2">SAVE</button>
        </div>
      </section>
    </main>

    <footer class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4 p-4">
      <!-- History -->
      <section class="col-span-1 bg-gray-800 p-4 rounded-lg text-sm">
        <h2 class="text-base font-bold">History</h2>
        <p>Illnesses: Polycythemia Vera</p>
        <p>Operations: Appendectomy at age 12</p>
        <p>Medications: Simvastatin 40mg daily</p>
      </section>

      <!-- SOFA Score -->
      <section class="col-span-1 bg-gray-800 p-4 rounded-lg text-sm">
        <h2 class="text-base font-bold">Overall SOFA Score: 3</h2>
        <canvas id="sofa-chart" class="w-full h-32"></canvas>
      </section>

      <!-- Other Sections -->
      <section class="col-span-1 bg-gray-800 p-4 rounded-lg text-sm">
        <h2 class="text-base font-bold">Similar Patients</h2>
        <canvas id="similar-patients-chart" class="w-full h-32"></canvas>
      </section>
      <section class="col-span-1 bg-gray-800 p-4 rounded-lg text-sm">
        <h2 class="text-base font-bold">Similar Patients</h2>
        <canvas id="similar-patients-chart" class="w-full h-32"></canvas>
      </section>
      <section class="col-span-1 bg-gray-800 p-4 rounded-lg text-sm">
        <h2 class="text-base font-bold">Similar Patients</h2>
        <canvas id="similar-patients-chart" class="w-full h-32"></canvas>
      </section>
      <section class="col-span-1 bg-gray-800 p-4 rounded-lg text-sm">
        <h2 class="text-base font-bold">Similar Patients</h2>
        <canvas id="similar-patients-chart" class="w-full h-32"></canvas>
      </section>
    </footer>
  </body>
</html>
