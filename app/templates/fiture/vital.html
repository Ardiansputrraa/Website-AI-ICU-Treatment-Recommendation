<!-- Vitals -->
<section
  class="col-span-1 md:col-span-2 lg:col-span-1 dark:bg-gray-900 bg-white p-4 rounded-lg"
>
  <!-- Heart Rate -->
  <div class="mb-2">
    <!-- Ikon dan Judul -->
    <div class="flex items-center justify-between mb-4">
      <!-- Tambahkan ikon MDI -->
      <div class="flex flex-col items-start">
        <i class="mdi mdi-heart-pulse text-4xl text-red-500"></i>
        <p class="text-[12px] mt-2 text-gray-900 dark:text-gray-200">
          HEART RATE
        </p>
      </div>

      <!-- Value -->
      <div class="flex items-baseline">
        <p
          class="text-4xl font-bold text-black dark:text-white"
          id="heart-rate-value"
        >
          60
        </p>
        <p class="text-sm text-black dark:text-white ml-1">bpm</p>
      </div>
    </div>
    <!-- Grafik -->
    <div>
      <canvas id="heartRate" class="w-full h-40"></canvas>
    </div>
  </div>

  <!-- Oxygen Saturation -->
  <div class="mb-2">
    <!-- Ikon dan Judul -->
    <div class="flex items-center justify-between mb-4">
      <!-- Tambahkan ikon MDI -->
      <div class="flex flex-col items-start">
        <i class="mdi mdi-heart-plus-outline text-4xl text-red-500"></i>
        <p class="text-[12px] mt-2 text-gray-900 dark:text-gray-200">
          OXYGEN SATURATION
        </p>
      </div>

      <!-- Value -->
      <div class="flex items-baseline">
        <p
          class="text-4xl font-bold text-black dark:text-white"
          id="oxygen-saturation-value"
        >
          60
        </p>
        <p class="text-sm text-black dark:text-white ml-1">%</p>
      </div>
    </div>
    <!-- Grafik -->
    <div>
      <canvas id="oxygenSaturation" class="w-full h-40"></canvas>
    </div>
  </div>

  <!-- Respiratory Rate -->
  <div class="mb-2">
    <!-- Ikon dan Judul -->
    <div class="flex items-center justify-between mb-4">
      <!-- Tambahkan ikon MDI -->
      <div class="flex flex-col items-start">
        <i class="mdi mdi-lungs text-4xl text-red-500"></i>
        <p class="text-[12px] mt-2 text-gray-900 dark:text-gray-200">
          RESPIRATORY RATE
        </p>
      </div>
      <!-- Value -->
      <div class="flex items-baseline">
        <p
          class="text-4xl font-bold text-black dark:text-white"
          id="respiratory-rate-value"
        >
          60
        </p>
        <p class="text-sm text-black dark:text-white ml-1">rpm</p>
      </div>
    </div>
    <!-- Grafik -->
    <div>
      <canvas id="respiratoryRate" class="w-full h-40"></canvas>
    </div>
  </div>
</section>

<script>
  // Waktu untuk pembaruan data
  let time = 0;

  function generateHeartRateWaveform(t) {
    const baseline = 75; // Rata-rata heart rate normal (bpm)
    const amplitude = 5; // Fluktuasi kecil di sekitar baseline (5 bpm)
    const frequency = 0.1; // Frekuensi gelombang lambat (1 siklus dalam 10 detik)
    const smoothFactor = 0.02; // Faktor pergerakan yang halus untuk perubahan grafik
    const noise = Math.random() * 0.5 - 0.25; // Variasi kecil (noise) untuk membuat grafik alami

    const heartRate = baseline + amplitude * Math.sin(frequency * t) + noise;
    const smoothHeartRate =
      heartRate * (1 - smoothFactor) + baseline * smoothFactor;
    return Math.min(Math.max(smoothHeartRate, 50), 120);
  }

  function generateOxygenSaturationWaveform(t) {
    const amplitude = 2;
    const baseline = 98;
    const frequency = 0.2;
    const noise = Math.random() * 0.5 - 0.25;
    return baseline + amplitude * Math.sin(frequency * t + Math.PI / 2) + noise;
  }

  function generateRespiratoryRateWaveform(t) {
    const amplitude = 2;
    const baseline = 20;
    const frequency = 0.1;
    const noise = Math.random() * 1 - 0.5;
    return baseline + amplitude * Math.sin(frequency * t) + noise;
  }

  function initializeChart() {
    const heartRateCtx = document.getElementById("heartRate").getContext("2d");
    const heartRateChart = new Chart(heartRateCtx, {
      type: "line",
      data: {
        labels: Array.from({ length: 100 }, () => ""),
        datasets: [
          {
            borderColor: "#9933FF",
            borderWidth: 2,
            fill: false,
            tension: 0.4,
            data: Array.from({ length: 100 }, (_, i) =>
              generateHeartRateWaveform(i)
            ),
          },
        ],
      },
      options: {
        responsive: true,
        animation: false,
        plugins: {
          legend: { display: false },
        },
        scales: {
          x: { display: false },
          y: { display: false },
        },
        elements: {
          point: { radius: 0 },
        },
      },
    });

    const oxygenSaturationCtx = document
      .getElementById("oxygenSaturation")
      .getContext("2d");
    const oxygenSaturationChart = new Chart(oxygenSaturationCtx, {
      type: "line",
      data: {
        labels: Array.from({ length: 100 }, () => ""),
        datasets: [
          {
            borderColor: "#9933FF",
            borderWidth: 2,
            fill: false,
            tension: 0.4,
            data: Array.from({ length: 100 }, (_, i) =>
              generateOxygenSaturationWaveform(i)
            ),
          },
        ],
      },
      options: {
        responsive: true,
        animation: false,
        plugins: {
          legend: { display: false },
        },
        scales: {
          x: { display: false },
          y: { display: false },
        },
        elements: {
          point: { radius: 0 },
        },
      },
    });

    const respiratoryRateCtx = document
      .getElementById("respiratoryRate")
      .getContext("2d");
    const respiratoryRateChart = new Chart(respiratoryRateCtx, {
      type: "line",
      data: {
        labels: Array.from({ length: 100 }, () => ""),
        datasets: [
          {
            borderColor: "#9933FF",
            borderWidth: 2,
            fill: false,
            tension: 0.4,
            data: Array.from({ length: 100 }, (_, i) =>
              generateRespiratoryRateWaveform(i)
            ),
          },
        ],
      },
      options: {
        responsive: true,
        animation: false,
        plugins: {
          legend: { display: false },
        },
        scales: {
          x: { display: false },
          y: { display: false },
        },
        elements: {
          point: { radius: 0 },
        },
      },
    });

    return {
      heartRateChart,
      oxygenSaturationChart,
      respiratoryRateChart,
    };
  }

  window.onload = () => {
    const { heartRateChart, oxygenSaturationChart, respiratoryRateChart } =
      initializeChart();

    let heartRateData = Array.from({ length: 100 }, () => 60);
    let oxygenSaturationData = Array.from({ length: 100 }, () => 98);
    let respiratoryRateData = Array.from({ length: 100 }, () => 20);

    setInterval(() => {
      const heartRate = generateHeartRateWaveform(time);
      heartRateData.push(heartRate);
      if (heartRateData.length > 100) {
        heartRateData.shift();
      }
      heartRateChart.data.datasets[0].data = heartRateData;
      heartRateChart.update();
      document.getElementById("heart-rate-value").innerText = Math.round(
        heartRate
      );

      const oxygenSaturation = generateOxygenSaturationWaveform(time);
      oxygenSaturationData.push(oxygenSaturation);
      if (oxygenSaturationData.length > 100) {
        oxygenSaturationData.shift();
      }
      oxygenSaturationChart.data.datasets[0].data = oxygenSaturationData;
      oxygenSaturationChart.update();
      document.getElementById("oxygen-saturation-value").innerText = Math.round(
        oxygenSaturation
      );

      const respiratoryRate = generateRespiratoryRateWaveform(time);
      respiratoryRateData.push(respiratoryRate);
      if (respiratoryRateData.length > 100) {
        respiratoryRateData.shift();
      }
      respiratoryRateChart.data.datasets[0].data = respiratoryRateData;
      respiratoryRateChart.update();
      document.getElementById("respiratory-rate-value").innerText = Math.round(
        respiratoryRate
      );

      time++;
    }, 100);
  };
</script>

